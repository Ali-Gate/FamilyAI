{% extends 'base.html' %}
{% block content %}

<h1>Your Notifications</h1>
<div id="notifications-container">
    Loading notifications...
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            console.log('Fetching notifications...');
            const response = await fetch('/api/notifications/', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            });
            console.log('Response status:', response.status);
    
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Response error text:', errorText);
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const data = await response.json();
            console.log('Data received:', data);
    
            const container = document.getElementById('notifications-container');
            container.innerHTML = '';
    
            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = '<p>No notifications found.</p>';
                return;
            }
    
            data.forEach(notification => {
                const item = document.createElement('div');
                item.classList.add('notification');
                item.innerHTML = `
                    <strong>${notification.title}</strong><br>
                    <small>From: ${notification.ticket_creator || 'System'}</small><br>
                    <p>${notification.description}</p>
                    <hr>
                `;
                container.appendChild(item);
            });
        } catch (error) {
            console.error('Error fetching notifications:', error);
            const container = document.getElementById('notifications-container');
            if (container) container.innerText = 'Failed to load notifications.';
        }
    });
    </script>

{% endblock %}